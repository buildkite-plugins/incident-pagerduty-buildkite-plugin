name: Incident PagerDuty
description: Create PagerDuty incidents when Buildkite builds or jobs fail
author: https://github.com/buildkite-plugins
requirements:
  - bash
  - curl
  - jq
configuration:
  properties:
    integration-key:
      type: string
      description: "PagerDuty integration key for Events API v2. This is a 32-character hex string found in your service's integrations."
    check:
      type: string
      description: "What to check for failures: 'job' (this step) or 'build' (any step in build). Defaults to 'job'."
      enum:
        - build
        - job
      default: job
    severity:
      type: string
      description: "PagerDuty incident severity. Defaults to 'error'."
      enum:
        - critical
        - error
        - warning
        - info
      default: error
    dedup-key:
      type: string
      description: "Custom deduplication key. If not provided, will be auto-generated based on build/job details."
    soft-fail-statuses:
      description: "Exit statuses that should be treated as soft-fail (no incident). Accepts '*' or a list of exit codes."
      oneOf:
        - type: string
          enum:
            - "*"
        - type: array
          items:
            type: string
  required:
    - integration-key
  additionalProperties: false
